/*! Skuid Rockaway 8.11.0 02-06-2016 */
!function(a){var b=a.$,c=a.snippet.registerSnippet,d=a.utils,e="/resource/skuid__DefaultPhotos/Org.jpg",f="salesforce",g=function(c){var d,e=c.field,f=a.utils.decodeHTML(c.value),g=c.filterFunction,h=c.isRequired,i=c.model,j=c.renderas;if("edit"===e.mode?(d=b.map(g?i.getRows().filter(g):i.getRows(),function(a){return{label:a.Name,value:a.Name}}),e.element.html(a.ui.renderers.PICKLIST.edit({value:f,required:h,onChange:function(a){e.model.updateRow(e.row,e.id,a,{initiatorId:e._GUID})},entries:d,renderas:j}))):a.ui.fieldRenderers[e.metadata.displaytype][e.mode](e,f),!e._mspSubscriptions){e._mspSubscriptions=a.events.subscribe(["models.saved","models.cancelled","models.loaded"],function(a){i.id in a.models&&e.render()});var k=e.unregister;e.unregister=function(){b.each(e._mspSubscriptions,function(){a.events.unsubscribe(this)}),k()}}},h=function(c){var d=c.field,e=c.value,f=c.entries,g=c.onChange;"edit"===d.mode?d.element.html(a.ui.renderers.PICKLIST.edit({value:e,required:!0,onChange:function(a){d.model.updateRow(d.row,d.id,a,{initiatorId:d._GUID}),g&&c.onChange(a)},entries:f})):(b.each(f,function(){return e===this.value?(e=this.label,!1):void 0}),a.ui.fieldRenderers[d.metadata.displaytype][d.mode](d,e))},i=function(c,d,e){d=a.utils.decodeHTML(arguments[1]);var f={};b.extend(!0,f,c.metadata),c.metadata=f,f.picklistEntries=e,a.ui.fieldRenderers.MULTIPICKLIST[c.mode](c,d)},j=function(c,d,e,f){d=a.utils.decodeHTML(d);var g=c.metadata;if("edit"==c.mode){g={},b.extend(!0,g,c.metadata),c.metadata=g;var h=[],i={};if(b.each(g.referenceTo,function(a,c){return-1==b.inArray(c.objectName,e)||i[c.objectName]||(h.push(c),i[c.objectName]=1,h.length!=e.length)?void 0:!1}),h.length){f&&(c.options.type="REFPICK"),g.referenceTo.length=0;var j=[];b.each(h,function(){j.push(this.objectName)}),g.ref=j.join(),g.referenceTo=h}}a.ui.fieldRenderers[g.displaytype][c.mode](c,d),f&&(c.options.type="CUSTOM")},k=function(b){var c=b.field,d=b.value;if("edit"===c.mode){c.element.css({height:b.height||"300px",width:"100%"}),d||(d="{}");var e=new JSONEditor(c.element.get(0),{change:function(){c.model.updateRow(c.row,c.id,e.getText(),{initiatorId:c._GUID})}},JSON.parse(d))}else a.ui.fieldRenderers[c.metadata.displaytype][c.mode](c,d)},l=function(c,d,e){var f,g,h;return b.each(c,function(a,b){return b.Name!==d||b.NamespacePrefix!==e&&(e||b.NamespacePrefix)?void 0:(f=b,!1)}),h=f?a.time.parseSFDateTime(f.SystemModstamp).getTime()+"/":"",f&&(g=f.NamespacePrefix),"/resource/"+h+(g?g+"__":"")+d+"/"},m=function(c){var d=c.field,e=c.value,f=c.themes,g=c.themeResources,h=c.dialogTitle||"Choose Theme";if("edit"===d.mode){var i=function(){var a=b("<div>"),c=b('<div class="themes-wrapper">');b.each(f,function(a,d){var f=b('<div data-theme="'+d.Name+'">').addClass("theme-card");d.Name===e&&f.addClass("selected");var h=b('<div class="theme-label">').text(d.Name),i=d.skuid__Resource_Namespace__c,j=d.skuid__Resource_Name__c,k=l(g,j,i)+"screenshot.png",m=b('<div class="theme-screenshot">').append(b("<img>").attr({src:k,width:"350"}));f.append(m,h),c.append(f)}),c.on("click",".theme-card",function(){var c=b(this),e=c.data("theme");d.model.updateRow(d.row,d.id,e,{initiatorId:d._GUID}),a.dialog("close")}),a.append(c),a.dialog({width:"90%",height:600,modal:!0,title:h,close:function(){j||(d.mode="read"),d.render()}})},j=d.item.list.editor.element.is(".nx-skootable");j?d.element.append(b('<div class="nx-fieldtext">').text(e).append(b("<button>").css({cursor:"pointer","margin-left":"10px","vertical-align":"middle"}).append(b('<div class="sk-icon inline sk-icon-photoview">')).skootip("Click to change Theme").on("click",i))):i()}else a.ui.fieldRenderers[d.metadata.displaytype][d.mode](d,e)};c("AuthRequestBodyContentTypes",function(){h({field:arguments[0],value:a.utils.decodeHTML(arguments[1]),entries:[{label:"Form Data (application/x-www-form-urlencoded)",value:"application/x-www-form-urlencoded"},{label:"JSON (application/json)",value:"application/json"}]})}),c("JSONEditor",function(){return k({field:arguments[0],value:a.utils.decodeHTML(arguments[1])})}),c("JSONEditor_Short",function(){return k({field:arguments[0],value:a.utils.decodeHTML(arguments[1]),height:"150px"})}),c("NameFieldNoLink",function(b,c){b.metadata.nameField=!1,a.ui.fieldRenderers[b.metadata.displaytype][b.mode](b,a.utils.decodeHTML(c)),b.metadata.nameField=!0}),c("PasswordInput",function(b,c){a.ui.fieldRenderers[b.metadata.displaytype][b.mode](b,a.utils.decodeHTML(c)),"edit"===b.mode&&b.element.find(":input").attr({type:"password",maxlength:"140"})}),c("MaxLengthInput",function(b,c){a.ui.fieldRenderers[b.metadata.displaytype][b.mode](b,a.utils.decodeHTML(c)),"edit"===b.mode&&b.element.find(":input").attr({maxlength:"140"})}),c("ThemePicker_Composer_Desktop",function(b,c){m({field:b,value:c,themes:a.$M("stng__Themes_Desktop").getRows([{field:"Name",operator:"in",values:["Composer Light","Composer Dark"],type:"multiple"}]),themeResources:a.$M("stng__DesktopThemeResources").getRows(),dialogTitle:"Choose Desktop Composer Theme"})}),c("ThemePicker_Composer_Mobile",function(c,d){return g({field:c,value:d,isRequired:!0,model:a.$M("stng__Themes_Mobile"),filterFunction:function(a){return"Mobile"===a.skuid__Type__c&&-1!==b.inArray(a.Name,["MobileClassic"])}})}),c("ThemePicker_Desktop",function(b,c){m({field:b,value:c,themes:a.$M("stng__Themes_Desktop").getRows([{field:"Name",operator:"not in",values:["Composer Light","Composer Dark"],type:"multiple"},{field:"skuid__Active__c",value:!0}]),themeResources:a.$M("stng__DesktopThemeResources").getRows()})}),c("ThemePicker_Mobile",function(b,c){m({field:b,value:c,themes:a.$M("stng__Themes_Mobile").getRows([{field:"skuid__Active__c",value:!0}]),themeResources:a.$M("stng__MobileThemeResources").getRows()})}),c("ThemeTypePicklist",function(){var b=arguments[0],c=a.utils.decodeHTML(arguments[1]);"edit"===b.mode?b.element.html(a.ui.renderers.PICKLIST.edit({value:c,required:!0,onChange:function(a){b.model.updateRow(b.row,b.id,a)},entries:[{label:"Desktop",value:"Desktop"},{label:"Mobile",value:"Mobile"}]})):a.ui.fieldRenderers[b.metadata.displaytype][b.mode](b,c)}),c("ModelAdapterPicker",function(b,c){return g({field:b,value:c,isRequired:!0,model:a.$M("stng__ModelAdapters")})}),c("ModelAdapterPicker_Radio",function(b,c){return g({field:b,value:c,isRequired:!0,model:a.$M("stng__ModelAdapters"),renderas:"RADIO_BUTTONS"})}),c("ServiceAccessMethod",function(){var b=arguments[0],c=b.row,d=b.model,e=[{label:"Unrestricted (Anyone can use)",value:"any"}];d.getFieldValue(c,"skuid__Use_Apex_Proxy__c")&&e.push({label:"Require Named Permission",value:"namedperm"}),h({field:arguments[0],value:a.utils.decodeHTML(arguments[1]),entries:e})}),c("stng__CustomPermissionsPicklist",function(){var c=[];b.each(a.$M("stng__CustomPermissions").data,function(a,b){var d=(b.NamespacePrefix?b.NamespacePrefix+"__":"")+b.DeveloperName,e=b.MasterLabel+(b.NamespacePrefix?" ("+b.NamespacePrefix+")":"");c.push({value:d,label:e,active:!0,defaultValue:0===a})}),h({field:arguments[0],value:a.utils.decodeHTML(arguments[1]),entries:c,required:!0})});var n='{"Authorization":"Bearer {{$Auth.Response.Body.access_token}}"}',o={salesforce:{label:"Salesforce",value:f,authorizationUrl:"https://<My Domain>.my.salesforce.com/services/oauth2/authorize",tokenUrl:"https://<My Domain>.my.salesforce.com/services/oauth2/token",requestHeaders:n},sharepointonline:{label:"SharePoint Online",value:"sharepointonline",authorizationUrl:"https://<Company Name>.sharepoint.com/<Site Collection Path>_layouts/15/OauthAuthorize.aspx",tokenUrl:"https://accounts.accesscontrol.windows.net/<Company Name>.onmicrosoft.com/tokens/OAuth/2",tokenRequestBodyParams:'{"resource":"00000003-0000-0ff1-ce00-000000000000/<Company Name>.sharepoint.com@<Company Name>.onmicrosoft.com"}',requestHeaders:n},google:{label:"Google",value:"google",authorizationUrl:"https://accounts.google.com/o/oauth2/auth",tokenUrl:"https://accounts.google.com/o/oauth2/token",requestHeaders:n},github:{label:"Github",value:"github",authorizationUrl:"https://github.com/login/oauth/authorize",tokenUrl:"https://github.com/login/oauth/access_token",requestHeaders:n},facebook:{label:"Facebook",value:"facebook",authorizationUrl:"https://www.facebook.com/dialog/oauth/",tokenUrl:"https://graph.facebook.com/oauth/access_token",requestHeaders:n},dropbox:{label:"Dropbox",value:"dropbox",authorizationUrl:"https://www.dropbox.com/1/oauth2/authorize",tokenUrl:"https://api.dropbox.com/1/oauth2/token",requestHeaders:n},other:{label:"Other",value:"other",authorizationUrl:"",tokenUrl:"",requestHeaders:n}};c("AuthProviderTypesPicklist",function(){var c=arguments[0];h({field:c,value:a.utils.decodeHTML(arguments[1]),entries:b.map(o,function(a){return{value:a.value,label:a.label}}),onChange:function(d){var e=o[d],f={};b.each({authorizationUrl:"skuid__Authorize_Endpoint_URL__c",tokenUrl:"skuid__Token_Endpoint_URL__c",requestHeaders:"skuid__Request_Headers__c",tokenRequestBodyParams:"skuid__Token_Request_Body_Parameters__c",clientId:"skuid__Client_Id__c"},function(a,b){f[b]=e.hasOwnProperty(a)?e[a]:""}),a.utils.size(f)&&c.model.updateRow(c.row,f,{initiatorId:c._GUID})}})}),c("AuthProviderApexClasses",function(){var b=arguments[0],c=a.utils.decodeHTML(arguments[1]);j(b,c,["ApexClass"],!1)}),c("AuthProviderPicklist",function(b,c,d){var e=b.row,h=e.skuid__Authentication__c,i=e.skuid__Adapter_Name__c;return g({field:b,value:a.utils.decodeHTML(c),isRequired:!1,model:a.$M("stng__AuthProviders"),filterFunction:function(a){var b=a.skuid__Auth_Method__c||"oauth2";return i===f?a.skuid__Type__c===f:"provider"===h&&("apex"!==b||"Sharepoint"===i&&"apex"===b)},renderas:d?d.renderas:null})}),c("AuthProviderPicklist_Radio",function(){a.snippet.get("AuthProviderPicklist")(arguments[0],arguments[1],{renderas:"RADIO_BUTTONS"})}),c("PackagesMultipicklist",function(c,d){var e=[];b.each(a.$M("stng__Packages").data,function(a,b){e.push({value:b.NamespacePrefix,label:b.NamespacePrefix,active:!0,defaultValue:0===a})}),i(c,d,e)}),c("stng__PermissionSetsMultipicklist",function(c,d){var e=[];b.each(a.$M("stng__PermissionSets").data,function(a,b){var c=(b.NamespacePrefix?b.NamespacePrefix+"__":"")+b.Name,d=b.Label+(b.NamespacePrefix?" ("+b.NamespacePrefix+")":"");e.push({value:c,label:d,active:!0,defaultValue:0===a})}),i(c,d,e)}),c("ProfileLookup",function(a,b){j(a,b,["Profile"],!1)}),c("UserOrProfileLookup",function(a,b){j(a,b,["User","Profile"],!1)}),c("skuid.settings.modelServiceCreds.profileSelector",function(c,d){var e,f=c.mode,g=c.metadata.displaytype,h=a.$M("_inline_Profiles"),i=[],j=b.Deferred();void 0===h?(h=a.model.registerModel("_inline_Profiles",{id:"_inline_Profiles",objectName:"Profile",fields:[{id:"Id"},{id:"Name"}],doQuery:!0,orderByClause:"Name"}),h.updateData(function(){j.resolve()})):j.resolve(),j.done(function(){i=b.map(h.getRows(),function(a){var b=h.getFieldValue(a,"Name"),c=h.getFieldValue(a,"Id");return c===d&&(e=b),{label:b,value:c}}),"edit"!==f?a.ui.fieldRenderers[g][f](c,e||d):c.element.append(a.ui.renderers.PICKLIST.edit({value:d,entries:i,required:!0,onChange:function(a,b){a!==b&&c.model.updateRow(c.row,c.id,a,{initiatorId:c._GUID})}}))})});var p=new Image;p.src=e;var q=function(a){return JSON.stringify(a,void 0,3)};c("skuid.loadJSZip",function(){var c=b.Deferred();return"undefined"!=typeof JSZip?c.resolve():a.utils.loadJS("/resource/skuid__JSZip",function(){c.resolve()}),c.promise()}),c("skuid.newComponentPackPreSave",function(){var b=arguments[0],c=a.$,d=c.Deferred(),e=b.row,f=b.model,g=e.skuid__Resource_Name__c,h="sk-icon-component-pack",i=e.Name,j="Mobile"==e.skuid__Type__c,k=i+(j?"Mobile":"")+"Components",l=1,m=!1;if(c.each(f.getRows(),function(){this.skuid__Load_Order__c&&this.skuid__Load_Order__c>l&&(l=this.skuid__Load_Order__c+1)}),f.updateRow(e,{skuid__Load_Order__c:l}),c.each(f.registeredLists,function(a,b){return b.validateRequiredFields().length?(m=!0,!1):void 0}),m)return d.reject(),!1;var n={id:i,components:[{id:"sayhello"}],js:[{path:"runtime.js"}],css:[{path:"runtime.css"}]},o={id:i,components:[{id:"sayhello",folderId:i}],folders:[{id:i,name:g,icon:h}],js:[{path:"builders.js"}],css:[{path:"builders.css"}]},p='(function(skuid){\n	skuid.componentType.register("'+i+'__sayhello",function(element,xmlDef){\n		element.addClass("hello-content").html("<b>Hello " + xmlDef.attr("person") + "</b>");\n	});\n})(skuid);',r='(function($) {\n	skuid.builder.core.registerBuilder(new skuid.builder.core.Builder({\n		id: "'+i+'__sayhello",\n		name: "Say Hello",\n		icon: "sk-icon-contact",\n		description: "This component says Hello to someone",\n		componentRenderer: function(component) {\n			component.setTitle(component.builder.name);\n			component.body.html(\n				"<div class=\'hello-content\'>Hello " + component.state.attr("person") + "!</div>"\n			);\n		},\n		mobileRenderer: function(component) {\n			component.setTitle(component.builder.name);\n			component.body.html(\n				"<div class=\'hello-content\'>Hello " + component.state.attr("person") + "!</div>"\n			);\n		},\n		propertiesRenderer: function (propertiesObj,component) {\n			propertiesObj.setTitle("Say Hello Component Properties");\n			var state = component.state;\n			var propCategories = [];\n			var propsList = [\n				{\n					id: "person",\n					type: "string",\n					label: "Person to say Hello to",\n					helptext: "Pick a name, any name!",\n					onChange: function(){\n						component.refresh();\n					}\n				}\n			];\n			propCategories.push({\n				name: "",\n				props: propsList,\n			});\n			if(skuid.mobile) propCategories.push({ name : "Remove", props : [{ type : "remove" }] });\n			propertiesObj.applyPropsWithCategories(propCategories,state);\n		},\n		defaultStateGenerator : function() {\n			return skuid.utils.makeXMLDoc("<'+i+"__sayhello person='"+a.utils.userInfo.firstName+"' />\");\n		}\n	}));\n})(skuid);\n",s=".hello-content {\n	color: black;\n	font-size: 18pt;\n}",t=".hello-content {\n	color:black;\n	font-size: 18pt;\n}",u=new JSZip;u.file("skuid_runtime.json",q(n)),u.file("skuid_builders.json",q(o)),u.file("runtime.js",p),u.file("builders.js",r),u.file("runtime.css",s),u.file("builders.css",t);var v=u.generate({type:"base64",compression:"DEFLATE"}),w={Name:k,ContentType:"application/zip",Body:v,CacheControl:"Public"};return c.ajax({type:"POST",url:"/services/data/v34.0/sobjects/StaticResource",headers:{"Content-Type":"application/json",Authorization:"Bearer "+a.utils.userInfo.sessionId},data:JSON.stringify(w),dataType:"json",success:function(){f.updateRow(e,{skuid__Resource_Name__c:k}),d.resolve()},error:function(){d.reject()}}),d.promise()});var r=function(c){var d=b.Deferred();return b.ajax({type:"POST",url:window.top.location.protocol+"//"+window.top.location.hostname+"/services/Soap/m/35.0",beforeSend:function(a){a.setRequestHeader("SOAPAction",'""'),a.setRequestHeader("Content-Type","text/xml")},data:'<?xml version="1.0" encoding="utf-8"?><env:Envelope xmlns:env="http://schemas.xmlsoap.org/soap/envelope/" xmlns="http://soap.sforce.com/2006/04/metadata" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><env:Header><urn:SessionHeader xmlns:urn="http://soap.sforce.com/2006/04/metadata"><urn:sessionId>'+sforce.connection.sessionId+"</urn:sessionId></urn:SessionHeader></env:Header><env:Body>"+c+"</env:Body></env:Envelope>"}).done(function(c,e,f){var g="",h=a.utils.makeXMLDoc(f.responseText),i=h.find("errors");i.length&&b.each(i,function(){g+=b(this).children("message").text()+"\n"}),g?d.reject(g):d.resolve()}).fail(function(a,b,c){d.reject(c.status)}),d.promise()},s=function(a){var b=a.split("/");return b[0]+"//"+b[2]};c("skuid.settings.newModelService.checkForRemoteSite",function(){var c=arguments[0],e=c.model,f=c.row,g="stng__ModelServices";e&&e.id===g||(e=a.$M(g)),f&&e.getRowById(f.Id)||(f=e.getFirstRow());var h=e.getFieldValue(f,"skuid__URL__c",!0),i=e.getFieldValue(f,"skuid__Use_Apex_Proxy__c",!0),j=!1,k=s(h);b.each(a.$M("stng__AuthProviders").getRows(),function(a,b){var c=b.skuid__Authorize_Endpoint_URL__c,e=b.skuid__Token_Endpoint_URL__c;return d.startsWith(c,k)||d.startsWith(e,k)?(j=!0,!1):void 0});var l=i&&!j;if(l){if(window.confirm("In order for this Model Service to be accessible by Skuid, you will need to create a Remote Site Setting corresponding to this Service's URL:\n\n - "+h+" \n\nWould you like Skuid to try to see if a Remote Site Setting corresponding to this URL already exists, and if not, create one for you?")){var m=e.getFieldValue(f,"Name",!0),n="For Skuid to access data from Model Service "+m,o=k.substring(k.indexOf("://")+3),p=m.replace(/[\W]+/g,"")+"_"+o.replace(/[\W]+/g,"");return p.length>40&&(p=p.substring(0,40)),b.blockUI({message:'Attempting to create a Remote Site Setting for URL: "'+h+'"'}),r('<createMetadata><metadata xsi:type="RemoteSiteSetting"><fullName>'+p+"</fullName><description>"+n+"</description><disableProtocolSecurity>false</disableProtocolSecurity><isActive>true</isActive><url>"+k+"</url></metadata></createMetadata>").done(function(){b.blockUI({message:"A Remote Site Setting has successfully been created!",timeout:2e3})}).fail(function(a){b.blockUI({message:"There was a problem creating the Remote Site for this URL:<br/><br/>"+a,timeout:3e3})})}return b.unblockUI(),!0}return b.unblockUI(),!0}),c("skuid.settings.newAuthProvider.checkForRemoteSites",function(){var c=arguments[0],d=c.model,e=c.row,f="stng__AuthProviders";d&&d.id===f||(d=a.$M(f)),e&&d.getRowById(e.Id)||(e=d.getFirstRow());var g={},h=b.map(["skuid__Authorize_Endpoint_URL__c","skuid__Token_Endpoint_URL__c","skuid__User_Info_Endpoint_URL__c"],function(a){var b=d.getFieldValue(e,a,!0),c=b?s(b):!1;return c&&!g[c]?(g[c]=1,c):void 0});if(!h.length||!window.confirm("In order for Skuid to authenticate using this Auth Provider, you will need to create Salesforce Remote Site Settings for the following URL(s):\n\n - "+h.join("\n - ")+"\n\nWould you like Skuid to try to see if the necessary Remote Site Settings corresponding to these URL(s) already exist, and if not, create them for you?"))return b.unblockUI(),!0;var i=d.getFieldValue(e,"Name",!0);i&&(i=i.replace(/[\W]+/g,""));var j="For Skuid to authenticate using Auth Provider "+i,k=[];b.each(h,function(a,b){var c=b.substring(b.indexOf("://")+3),d=i+"_"+c.replace(/[\W]+/g,"");d.length>40&&(d=d.substring(0,40)),k.push(r('<createMetadata><metadata xsi:type="RemoteSiteSetting"><fullName>'+d+"</fullName><description>"+j+"</description><disableProtocolSecurity>false</disableProtocolSecurity><isActive>true</isActive><url>"+b+"</url></metadata></createMetadata>"))}),b.blockUI({message:"Attempting to create Remote Site Settings for "+h.length+" URL(s) ..."}),b.when.all(k).done(function(){b.blockUI({message:h.length+" Remote Site Setting(s) have successfully been created!",timeout:2e3})}).fail(function(a){b.blockUI({message:"There was a problem creating the Remote Site Setting(s) for these URL(s):<br/><br/>"+a,timeout:3e3})})}),c("skuid.updateCache",function(b){var c=b.item.row,e=c.skuid__Resource_Name__c,f=c.skuid__Resource_Namespace__c,g=c.skuid__Runtime_Definition_File__c||"skuid_runtime.json",h=a.component.getByType("pagetitle")[0].element.data("object").editor;d.getJSONBodyOfZIPResourceFile(e,f,g).done(function(a){if(a){var d,f,g,i,j=[],k=255,l={},m=15;for(d=JSON.stringify(a);d;){if(d.length<k){j.push(d);break}j.push(d.substr(0,k)),d=d.substr(k)}if(j.length<m){for(i=0;m>i;i++)f=m>i?"0"+(i+1):i+1,g=j[i]||"",l["skuid__Package_Cache"+f+"__c"]=g;b.model.updateRow(c,l)}else h.handleMessages([{message:"Your package definition is too large to be cached.",severity:"ERROR"}])}else h.handleMessages([{message:'Unable to retrieve "'+e+'" Component Pack definition',severity:"ERROR"}])})}),c("skuid.settings.copyPrefsFromOrgDefault",function(){var c=arguments[0],d=c.row,e=c.model,f=a.$M("stng__OrgPreferences"),g=f.getFirstRow(),h={};b.each(f.fields,function(){a.utils.startsWith(this.id,"skuid__")&&"skuid__Use_Component_Packs__c"!==this.id&&(h[this.id]=f.getFieldValue(g,this.id,!0))}),e.updateRow(d,h,{initiatorId:c.initiatorId})}),c("skuid.theme.createThemeResource",function(){var b,c,d,e,f=arguments[0],g=a.$,h=g.Deferred(),i=f.row,j=f.model,k=i.BaseTheme,l=i.Name,m=i.skuid__Resource_Name__c,n="Mobile"==i.skuid__Type__c,o=m,p=!1;if(g.each(j.registeredLists,function(a,b){return b.validateRequiredFields().length?(p=!0,!1):void 0}),p)return h.reject(),!1;b={id:l,lessVars:{},tempVars:{},baseTheme:k,isMobile:n},c=".hello-content {\n	color: black;\n	font-size: 18pt;\n}";var r=new JSZip;return r.file("skuid_theme.json",q(b)),r.file("skuidtheme.css",c),r.file("skuidbuilderstheme.css",c),r.file("skuidicons.css",c),d=r.generate({type:"base64",compression:"DEFLATE"}),e={Name:o,ContentType:"application/zip",Body:d,CacheControl:"Public"},g.ajax({type:"POST",url:"/services/data/v34.0/sobjects/StaticResource",headers:{"Content-Type":"application/json",Authorization:"Bearer "+a.utils.userInfo.sessionId},data:JSON.stringify(e),dataType:"json",success:function(){j.updateRow(i,{skuid__Resource_Name__c:o}),h.resolve()},error:function(){h.reject()}}),h.promise()}),c("skuid.theme.exportTheme",function(){var b,c,d=arguments[0],e=a.$,f=e.Deferred(),g=d.row;return delete g.Id,delete g.LastModifiedById,delete g.LastModifiedBy,delete g.attributes,b=JSON.stringify(g),c="/resource/"+(new Date).getTime()+"/"+g.skuid__Resource_Name__c,JSZipUtils.getBinaryContent(c,function(a,c){a&&f.reject();var d,e=new JSZip;e.load(c),e.file("objdef.json",b),d=e.generate({type:"blob",compression:"DEFLATE"}),saveAs(d,g.skuid__Resource_Name__c.split("SKTHEME").join(".sktheme")),f.resolve()}),f.promise()}),c("skuid.theme.importTheme",function(){var b=a.$,c=arguments[0],d=a.$M("stng__Themes_Import"),e=JSZip(c.Body,{base64:!0});if(e.files["objdef.json"]){var f=JSON.parse(e.files["objdef.json"].asText()),g=a.$M("stng__Themes_"+f.skuid__Type__c),h=b.Deferred(),i="SELECT Id FROM skuid__Theme__c  WHERE Name='"+f.Name+"'";a.sfdc.api.query(i).success(function(a){a.records&&a.records[0]?h.resolve(a):h.reject()}).fail(h.reject),h.done(function(a){d.conditions[0].value=a.records[0].Id,f.skuid__Resource_Name__c=c.Name,d.updateData(function(){var b=d.updateRow({Id:a.records[0].Id},f);d.save(),g.adoptRow(b)})}).fail(function(){var a=d.createRow({additionalConditions:[{field:"Name",value:f.Name},{field:"skuid__Resource_Name__c",value:c.Name},{field:"skuid__Type__c",value:f.skuid__Type__c},{field:"skuid__Active__c",value:f.skuid__Active__c},{field:"skuid__Resource_Namespace__c",value:f.skuid__Resource_Namespace__c}]});d.save({callback:function(c){if(c.messages){var d=b(b("#themeImportErrors").length?"#themeImportErrors":'<div id="themeImportErrors" class="nx-error">');d.prependTo(b("#importUploadTitle")),d.empty(),b.each(c.messages,function(a,b){d.append("<div>"+b+"</div>")})}else g.adoptRow(a)}})})}else window.alert("The uploaded file is not a valid skuid Theme")}),c("skuid.crypt.generateKey",function(c){var d=c.model,e=c.row,f=b.Deferred();return a.SkuidSettingsController.generateNewSkuidCryptKey(function(a){a&&"string"==typeof a?(d.updateRow(e,"skuid__Key__c",a),f.resolve()):f.reject()}),f.promise()});var t={};c("skuid.settings.changeModelServiceWithCreds",function(c){var d=c.model,e=c.row,f=d.getFieldValue(e,"Id"),g=d.getFieldValue(e,"StoredCredCount__ui"),h={};b.each(c.updates,function(a,b){var c=d.getField(a);c.uiOnly!==!0&&(h[a]=b)}),void 0===t[f]&&a.utils.size(h)&&g&&(t[f]=!0,window.confirm("WARNING: This Model Service has stored Model Service Credentials. For security reasons, Model Services with stored credentials cannot be changed. If you proceed, the records will automatically be deleted, but your changes will not be saved and the Model Service will be unavailable until the process completes. \n\nWould you like proceed?")||(d.cancelRowChanges(e),delete t[f]))}),c("skuid.settings.clearModelServiceChangeWarnings",function(){t={}}),c("skuid.settings.newModelServiceWizard.navigateToStep.newAuthProvider",function(){var b=a.$C("NewModelServiceWizard");b&&b.navigate("newAuthProvider_salesforce")})}(skuid);