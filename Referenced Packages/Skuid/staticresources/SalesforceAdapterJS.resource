/*! Skuid Rockaway 8.11.0 02-06-2016 */
!function(a){function b(a,c,d,e){if(c){var f,i,j,k,l,m,n=c.split(".");if("childRelationship"===a.type)k=a.referenceTo&&a.referenceTo.length&&a.referenceTo[0],k&&(l=e.service&&e.service.getCachedEntityMetadata(k.o),m=a.subFields,m&&g.each(m,function(a,c){b(c,c.id,l,e)}));else if(1===n.length){if(f=d&&d.getField&&d.getField(c)){i=e.getOverrideableFieldMetadata(a);var o=a.id,p=a.name;g.extend(!0,a,f),o&&(a.id=o),p&&(a.name=p),i&&g.each(i,function(b,c){a[b]=c})}if(a&&a["function"]){var q,r,s=a["function"];s&&(s=s.toUpperCase(),q=["CALENDAR_MONTH","CALENDAR_QUARTER","CALENDAR_YEAR","DAY_IN_MONTH","DAY_IN_WEEK","DAY_IN_YEAR","FISCAL_MONTH","FISCAL_QUARTER","FISCAL_YEAR","HOUR_IN_DAY","WEEK_IN_MONTH","WEEK_IN_YEAR"],r=["DAY_ONLY"],0===s.lastIndexOf("COUNT",0)?a.displaytype="INTEGER":"DATE"!==a.displaytype&&"DATETIME"!==a.displaytype||-1===q.indexOf(s)?"DATETIME"==a.displaytype&&-1!==r.indexOf(s)&&(a.displaytype="DATE"):a.displaytype="STRING",a.required=a.createable=a.editable=!1)}if(a&&"REFERENCE"===a.displaytype){var t,u,v,w;a.relationshipName||(a.relationshipName=a.rel),!a.ref&&a.referenceTo&&(t=a.referenceTo,t&&t.length&&(u=[],v=[],w={c:"createable",o:"objectName",l:"label",k:"keyPrefix",p:"labelPlural",s:"searchable"},g.each(t,function(a,b){b.o&&(u.push(b.o),v.push(b.k),g.each(w,function(a,c){b[c]=b[a],delete b[a]}),b.accessible=!0)}),u.length&&(a.ref=u.join(",")),v.length&&(a.refprefix=v.join(","))))}}else c=n.shift(),c=h.getReferenceFieldNameFromRelationshipField(c),f=d&&c&&d.getField&&d.getField(c),f&&(j=f.referenceTo,j&&1===j.length?d=e.service&&e.service.getCachedEntityMetadata(j[0].objectName||j[0].o):j&&j.length>1&&(d=e.service&&e.service.getCachedEntityMetadata("Name")),d&&b(a,n.join("."),d,e)),a.required=a.createable=a.editable=!1}}function c(a){if(a&&a.fields&&a.fields.length){var c=a.service&&a.service.getCachedEntityMetadata(a.objectName);g.each(a.fields,function(d,e){b(e,e.id,c,a)})}return a}function d(b){for(var c,d={},e=h.combineUrls(b.serviceUrl,"/services/apexrest/skuid/api/v1/models"),j=function(c){return function(d){var h,j,k,l=g.Deferred(),m=d&&!i(d)?JSON.stringify(d):null;return b.name===f?(k=[],m&&k.push(m),k.push(function(a,b){if(b.status){if(i(a))try{a=JSON.parse(a)}catch(c){}l.resolve(a)}else l.reject(b.message)},{escape:!1}),a.remote()[c].apply(window,k)):(h=m?"POST":"GET",j={method:h,url:e,headers:{"X-SKUID-REST-SERVICE-METHOD":c}},"POST"===h&&(j.body=m,j.contentType="application/json",j.headers["Content-Length"]=m.length),a.ajax.proxy(b.createHTTPRequest(j)).then(function(a){var b,c=a.body,d=a.statusCode;if(a.error)l.reject(a.error);else if(c){for(;i(c);)try{c=JSON.parse(c)}catch(e){}g.inArray(d,[200,201,204])<0?(b=d+" "+a.status+": ",1===c.length&&(b+=c[0].message),l.reject(b)):l.resolve(c)}},function(a){l.reject(a)})),l.promise()}},k=0,l=["load","save","getModelMetadata","getEntityList"];k<l.length;k++)c=l[k],d[c]=j(c);return b._sfdcRemote=d,d}function e(a){var b=a._sfdcRemote;return b||(b=new d(a)),b}var f="salesforce",g=a.$,h=a.utils,i=h.isString,j=1,k={Case:"CaseNumber",ContentDocument:"Title",ContentVersion:"Title",FeedItem:"Title",Idea:"Title",Solution:"SolutionName",Task:"Subject",Event:"Subject",PartnerNetworkConnection:"ConnectionName",CustomPermission:"MasterLabel"},l={CampaignMember:1,AccountContactRole:1,OpportunityContactRole:1,ContractContactRole:1,CaseContactRole:1,CaseComment:1,CaseSolution:1,OpportunityLineItem:1};new a.adapter.Adapter({name:f,prefillMetadataForObject:function(a){c(a.data)},getNameField:function(a){var b;return a&&(b=i(a)?a:a.objectName),b&&b in k?k[b]:b in l||b&&h.endsWith(b,"__x")?"Id":"Name"},save:function(a,b){var c=b.service;return c.authenticate().then(function(){var b={"[object Object]":1,"[object Array]":1};return g.each(a.operations,function(a,c){g.each(c.changes,function(a,c){g.each(c,function(a,d){(h.endsWith(a,"__r")||h.endsWith(a,"__pr")||h.toClass.call(d)in b)&&delete c[a]})})}),e(c).save(a)})},load:function(a,b){var c=b.service;return c.authenticate().then(function(){var d,f=["conditions","fields","groupByFields","havings","_parentPageId","_eventSubscriptions","accessible","actions","adapterName","changes","childRelationships","createable","data","dataMap","deleteable","debug","events","fieldsMap","hasChanged","isCustom","isCustomSetting","isFeedEnabled","isQueryable","isSearchable","label","labelPlural","keyPrefix","originals","recordTypeInfos","registeredConditions","registeredEditors","registeredFields","registeredFieldsByRowThenField","registeredItems","registeredItemsByRow","registeredLists","service","soql","updateable"],i=!1,j=g.map(a,function(a){var b={};for(var c in a)a.hasOwnProperty(c)&&g.inArray(c,f)<0&&(b[c]=a[c]);return g.each(["fields","groupByFields"],function(c,d){var e,f=a[d];f&&f.length&&(e=b[d]=[],g.each(f,function(a,b){var c;b.uiOnly?c=b:"childRelationship"===b.type?(c={id:b.id,type:b.type},g.each(["recordsLimit","orderByClause","subConditionLogic"],function(a,d){b.hasOwnProperty(d)&&null!==b[d]&&"undefined"!=typeof b[d]&&(c[d]=b[d])}),b.subConditions&&(c.subConditions=[],b.subConditions.length&&g.each(b.subConditions,function(a,b){var d={};for(var e in b)b.hasOwnProperty(e)&&null!==b[e]&&"undefined"!=typeof b[e]&&(d[e]=b[e]);c.subConditions.push(d)})),b.subFields&&(c.subFields=[],b.subFields.length&&g.each(b.subFields,function(a,d){var e={id:d.id};"undefined"!=typeof b.query&&null!==b.query&&(e.query=e.query),c.subFields.push(e)}))):(c={id:b.id},g.each(["name","function","query"],function(a,d){b.hasOwnProperty(d)&&null!==b[d]&&(c[d]=b[d])})),e.push(c)}))}),g.each(["conditions","havings"],function(c,d){var e,f=a[d];f&&f.length&&(e=b[d]=[],g.each(f,function(a,b){var c=g.extend({},b);for(var d in c)null===c[d]&&delete c[d];e.push(c)}))}),a.needsMetadataLoad&&(i=!0),b});return d=!b||b.loadAllMetadata||i?j:{operationModels:j,options:{excludeMetadata:!0}},e(c).load(d).then(function(a){var b,d=g.Deferred();return g.isArray(a)?d.resolve(a):a&&a.models?(b=a.metadata,b&&h.size(b)&&g.each(b,function(a,b){c.cacheEntityMetadata(a,b)}),d.resolve(a.models)):d.reject("Invalid Response Format"),d.promise()})})},isNewId:function(a){return!(i(a)&&(15===a.length||18===a.length))},getNewId:function(){return""+j++},getObjectList:function(b){var c=a.utils.sObjectList,d=b.service;return d.name===f&&c?g.Deferred().resolve(c).promise():d.authenticate().then(function(){return e(d).getEntityList()})},buildEntityMetadataRequest:function(a){var b=a.targetEntity;return!b&&a.model&&a.model.attr&&(b=a.model.attr("sobject")),{objectName:b}},getEntityMetadataLoadingMessageFromBreadcrumb:function(a){return"Loading metadata for object "+a.endsobject+"..."},getEntityMetadataCacheKey:function(a){return a.objectName},getEntityMetadata:function(a){var b=g.Deferred(),d=a.entities,f=a.service,h=a.ignoreMetadataOverrides?"true":"false";return d?f.authenticate().then(function(){var a=[];g.each(d,function(b,d){var j=g.Deferred(),k=i(d)?d:d.objectName,l={sObjectName:k,loadChildRelationships:"true",loadPicklistValues:"false",ignoreMetadataOverrides:h};d&&d.fields&&d.fields.length&&(l.fieldsToLoad=d.fields.join(",")),a.push(j.promise()),e(f).getModelMetadata(l).then(function(a){a?a instanceof Array&&a.length?j.resolve(g.map(a,function(a){return c(a),a})):(c(a),j.resolve(a)):j.resolve(a)},function(a){j.reject("There was an error retrieving metadata for object: "+k+": "+a)})}),g.when.all(a).then(function(a){b.resolve(a)},function(){b.reject("Unable to retrieve metadata for all requested objects.")})},function(){b.reject("Unable to authenticate to Salesforce. Metadata could not be retrieved.")}):b.reject("No SObject provided."),b.promise()},initialize:c,properties:{composer:{supports:{childRelationships:!0},canFieldsBeSelected:function(a){return a.breadcrumb.endsobject?!0:"Select an SObject for this Model"}},canAutoGenerateConditionsFromFields:!0,validConditionTypes:["fieldvalue","multiple","param","userinfo","blank","modelmerge","join"],canConditionsBeGrouped:!0}})}(skuid);